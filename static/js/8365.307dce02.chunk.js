"use strict";(self.webpackChunkidle_dashboard_new=self.webpackChunkidle_dashboard_new||[]).push([[8365,6624],{66624:function(e,t,n){n.r(t),n.d(t,{DynamicActionFields:function(){return x}});var i=n(1413),a=n(45987),r=n(5128),s=n(7276),l=n(12056),o=n(86059),u=n(60062),d=n(99594),c=n(15542),m=n(1669),v=n(3498),f=n(45263),p=["assetId","field","amount","amountUsd","stakingPower"],g=function(e){var t,n,l=e.assetId,g=e.field,x=e.amount,h=e.amountUsd,y=e.stakingPower,w=(0,a.Z)(e,p),S=(0,m.w)(),A=S.stakingData,b=S.helpers.vaultFunctionsHelper,j=S.selectors,k=j.selectAssetById,Z=j.selectVaultById,M=j.selectVaultGauge,C=(0,s.useMemo)((function(){return l&&k&&k(l)}),[l,k]),I=(0,s.useMemo)((function(){return l&&Z&&Z(l)}),[l,Z]),B=(0,s.useMemo)((function(){return l&&M&&M(l)}),[l,M]),F=(0,s.useMemo)((function(){return B&&k&&k(B.id)}),[B,k]),T=(0,s.useMemo)((function(){return(0,d.gA)(C.tvl).plus((0,d.d5)(x))}),[C,x]),E=(0,s.useMemo)((function(){return null===b||void 0===b?void 0:b.getVaultNewApr(C,I,(0,d.gA)(x))}),[C,I,x,b]),P=(0,s.useMemo)((function(){if((0,d.d5)(E).gt(0)){var e=(0,d.Bs)((0,d.d5)(E).div(100)).times(100),t=C.apyBreakdown?Object.keys(C.apyBreakdown||{}).filter((function(e){return"base"!==e})).reduce((function(e,t){switch(t){case"gauge":var n=null===F||void 0===F?void 0:F.gaugeData;if(n){var i=(0,d.d5)(null===n||void 0===n?void 0:n.totalSupply).plus((0,d.d5)(x)),a=(0,d.d5)(null===n||void 0===n?void 0:n.totalSupply).div(i),r=C.apyBreakdown[t].times(a);return e.plus(r)}return e.plus(C.apyBreakdown[t]);case"harvest":var s=(0,d.gA)(C.tvl).div(T),l=C.apyBreakdown[t].times(s);return e.plus(l);default:return e.plus(C.apyBreakdown[t])}}),(0,d.gA)(0)):(0,d.gA)(0);return(0,d.gA)(e).plus(t)}return(0,d.d5)(null===C||void 0===C?void 0:C.apy)}),[C,x,T,F,E]),U=(0,s.useMemo)((function(){return(0,d.d5)(h).gt(0)}),[h]),D=(0,s.useMemo)((function(){var e;return(0,d.d5)(null===C||void 0===C||null===(e=C.vaultPosition)||void 0===e?void 0:e.underlying.redeemable)}),[C]),L=(0,s.useMemo)((function(){var e;return(0,d.d5)(null===C||void 0===C||null===(e=C.vaultPosition)||void 0===e?void 0:e.usd.redeemable)}),[C]),_=(0,s.useMemo)((function(){var e,t;return"flags"in I&&(0,d.d5)(null===(e=I.flags)||void 0===e?void 0:e.withdrawFee).gt(0)?L.times(null===(t=I.flags)||void 0===t?void 0:t.withdrawFee):(0,d.gA)(0)}),[I,L]),G=(0,s.useMemo)((function(){var e;return r.Z.maximum(0,(0,d.d5)(null===C||void 0===C||null===(e=C.vaultPosition)||void 0===e?void 0:e.usd.earnings).minus(_))}),[_,C]),z=(0,s.useMemo)((function(){return r.Z.minimum(1,(0,d.d5)(h).div(L))}),[h,L]),V=(0,s.useMemo)((function(){return r.Z.minimum(G,z.times(G))}),[G,z]),N=(0,s.useMemo)((function(){var e;return r.Z.maximum(0,(0,d.d5)(null===C||void 0===C||null===(e=C.vaultPosition)||void 0===e?void 0:e.usd.earnings).times(null===C||void 0===C?void 0:C.fee))}),[C]),O=(0,s.useMemo)((function(){return r.Z.minimum(N,(0,d.d5)(V).times(null===C||void 0===C?void 0:C.fee))}),[N,V,C]);I instanceof u.C&&(G=G.plus(O),V=V.plus(O));var W=U&&(0,d.d5)(x).lte(D),H="cta",X=null;switch(g){case"boost":var $=P&&null!==C&&void 0!==C&&null!==(t=C.baseApr)&&void 0!==t&&t.gt(0)?P.div(null===C||void 0===C?void 0:C.baseApr):(0,d.gA)(0);X=(0,f.jsxs)(v.xv,(0,i.Z)((0,i.Z)({},w),{},{textStyle:"titleSmall",color:"primary",children:[$.toFixed(2),"x"]}));break;case"overperformance":var K=(0,d.d5)(h).times((0,d.gA)(null===C||void 0===C?void 0:C.baseApr).div(100)),R=(0,d.d5)(h).times((0,d.gA)(null===C||void 0===C?void 0:C.apy).div(100)),Y=U?R.minus(K):null;X=(0,f.jsx)(o.Amount.Usd,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary"},w),{},{value:Y,suffix:"/year"}));break;case"newApy":X=(0,f.jsx)(o.Amount.Percentage,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary"},w),{},{value:P}));break;case"totalGain":X=(0,f.jsx)(o.Amount.Usd,(0,i.Z)((0,i.Z)({decimals:V.lt(1)?4:2,textStyle:"titleSmall",color:"primary"},w),{},{value:W?V:null}));break;case"fee":X=(0,f.jsx)(o.Amount.Usd,(0,i.Z)((0,i.Z)({decimals:O.lt(1)?4:2,textStyle:"titleSmall",color:"primary"},w),{},{value:W?-O:null}));break;case"withdrawFee":(0,d.d5)(null===(n=I.flags)||void 0===n?void 0:n.withdrawFee).gt(0)&&(H="orange",X=(0,f.jsx)(o.Amount.Usd,(0,i.Z)((0,i.Z)({decimals:_.lt(1)?4:2,textStyle:"titleSmall",color:"orange"},w),{},{value:W?-_:null})));break;case"netGain":var q=r.Z.minimum(G.minus(O),(0,d.d5)(V).minus(O));X=(0,f.jsx)(o.Amount.Usd,(0,i.Z)((0,i.Z)({decimals:q.lt(1)?4:2,textStyle:"titleSmall",color:"primary"},w),{},{value:W?q:null}));break;case"coverage":var J=k(null===I||void 0===I?void 0:I.vaultConfig.Tranches.BB.address),Q=J.tvl&&T?J.tvl.div(T).times(100):0;X=(0,f.jsx)(o.Amount.Percentage,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary"},w),{},{value:Q}));break;case"stakingPoolShare":if(A){var ee=(0,d.d5)(x).div(A.stkIDLE.totalSupply.plus((0,d.d5)(x))).times(100);X=(0,f.jsx)(o.Amount.Percentage,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary"},w),{},{value:ee}))}break;case"stkIDLE":case"stkIDLEAfterIncrease":X=(0,f.jsx)(o.Amount,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary",suffix:" stkIDLE"},w),{},{value:x}));break;case"stakingApy":if(A){var te=(0,d.d5)(y).times(A.maxApr);X=(0,f.jsx)(o.Amount.Percentage,(0,i.Z)((0,i.Z)({textStyle:"titleSmall",color:"primary"},w),{},{value:te}))}break;default:return null}return X?(0,f.jsxs)(v.Ug,{pb:2,px:4,width:"100%",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"divider",justifyContent:"space-between",children:[(0,f.jsx)(c.Translation,{component:v.xv,translation:"dynamicActionFields.".concat(g),textStyle:"captionSmall",color:H}),X]}):null},x=function(e){var t=(0,m.w)().selectors.selectVaultById,n=e.assetId,a=e.action,r=(0,s.useMemo)((function(){return n&&t&&t(n)}),[n,t]),o=(0,s.useMemo)((function(){return(null===r||void 0===r?void 0:r.type)&&l.A[r.type]}),[r]),u=(0,s.useMemo)((function(){var e;return null!==o&&void 0!==o&&null!==(e=o.dynamicActionFields)&&void 0!==e&&e[a]?null===o||void 0===o?void 0:o.dynamicActionFields[a]:null}),[a,o]);return u?(0,f.jsx)(v.gC,{spacing:2,width:"100%",children:u.map((function(t){return(0,f.jsx)(g,(0,i.Z)((0,i.Z)({},e),{},{field:t}),"field_".concat(t))}))}):null}},98365:function(e,t,n){n.r(t),n.d(t,{Withdraw:function(){return B}});var i=n(74165),a=n(15861),r=n(29439),s=n(5128),l=n(54447),o=n(86059),u=n(93429),d=n(17373),c=n(99594),m=n(61617),v=n(15542),f=n(1128),p=n(85267),g=n(1669),x=n(7276),h=n(23023),y=n(4710),w=n(78951),S=n(66624),A=n(86393),b=n(75712),j=n(43127),k=n(52486),Z=n(3498),M=n(2092),C=n(73131),I=n(45263),B=function(e){var t=e.itemIndex,n=(0,x.useState)("0"),B=(0,r.Z)(n,2),F=B[0],T=B[1],E=(0,x.useState)(""),P=(0,r.Z)(E,2),U=P[0],D=P[1],L=(0,x.useState)(0),_=(0,r.Z)(L,2),G=_[0],z=_[1],V=(0,x.useState)(!1),N=(0,r.Z)(V,2),O=N[0],W=N[1],H=(0,x.useState)(null),X=(0,r.Z)(H,2),$=X[0],K=X[1],R=(0,x.useState)(!1),Y=(0,r.Z)(R,2),q=Y[0],J=Y[1],Q=(0,d.Y)().account,ee=(0,p.m)().searchParams,te=(0,y.useOperativeComponent)(),ne=te.dispatch,ie=te.activeItem,ae=te.activeStep,re=(0,b.useAssetProvider)(),se=re.asset,le=re.vault,oe=re.underlyingAsset,ue=re.translate,de=(0,h.R)(),ce=de.sendTransaction,me=de.setGasLimit,ve=de.state.transaction,fe=(0,g.w)().selectors,pe=fe.selectAssetPriceUsd,ge=fe.selectVaultPrice,xe=fe.selectAssetBalance,he=fe.selectVaultGauge,ye=fe.selectAssetById,we=(0,x.useMemo)((function(){return ee}),[ee]),Se=(0,r.Z)(we,2)[1],Ae=(0,x.useCallback)((function(){return J((function(e){return!e}))}),[J]),be=(0,x.useMemo)((function(){return xe?xe(null===le||void 0===le?void 0:le.id):(0,c.gA)(0)}),[xe,null===le||void 0===le?void 0:le.id]),je=(0,x.useMemo)((function(){return(null===se||void 0===se?void 0:se.id)&&he&&he(se.id)}),[he,null===se||void 0===se?void 0:se.id]),ke=(0,x.useMemo)((function(){return je&&ye&&ye(je.id)}),[ye,je]),Ze=(0,x.useMemo)((function(){var e,t;return le&&"getWithdrawInterestBearingContractSendMethod"in le&&"paused"===(null===se||void 0===se?void 0:se.status)&&(!("flags"in le)||void 0===(null===le||void 0===le||null===(e=le.flags)||void 0===e?void 0:e.redeemInterestBearingEnabled)||!(null===le||void 0===le||null===(t=le.flags)||void 0===t||!t.redeemInterestBearingEnabled))}),[le,se]),Me=(0,x.useMemo)((function(){return Ze&&q?"getWithdrawInterestBearing":"getWithdraw"}),[Ze,q]),Ce=(0,x.useMemo)((function(){return"".concat(Me,"Params")}),[Me]),Ie=(0,x.useMemo)((function(){return"".concat(Me,"ContractSendMethod")}),[Me]),Be=(0,x.useMemo)((function(){if(!xe)return(0,c.gA)(0);var e=xe(null===le||void 0===le?void 0:le.id),t=ge(null===le||void 0===le?void 0:le.id);return e.times(t)}),[xe,ge,null===le||void 0===le?void 0:le.id]),Fe=(0,x.useCallback)((function(){Be&&T(Be.toString())}),[Be]);(0,x.useEffect)((function(){Ze&&q?(Fe(),W(!0)):W(!1)}),[Fe,W,Ze,q]);var Te=(0,x.useMemo)((function(){return D(""),!(!(0,c.gA)(F).isNaN()&&!(0,c.gA)(F).lte(0))||((0,c.gA)(F).gt(Be)?(D(ue("trade.errors.insufficientFundsForAmount",{symbol:null===oe||void 0===oe?void 0:oe.name})),!0):"started"===ve.status)}),[F,ve,Be,oe,ue]),Ee=(0,x.useCallback)((function(){Q&&!Te&&le&&Ie in le&&Ce in le&&(0,a.Z)((0,i.Z)().mark((function e(){var t,n,a,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ge(le.id),n=s.Z.minimum(be,(0,c.gA)(F).div(t)),a=le[Ce](n),r=le[Ie](a),ce(le.id,le.id,r);case 5:case"end":return e.stop()}}),e)})))()}),[Q,Te,F,le,be,ge,ce,Ce,Ie]);(0,x.useEffect)((function(){ae===t&&"success"===ve.status&&T("")}),[ve.status,ae,t]),(0,x.useEffect)((function(){if(pe&&ge&&oe&&le){var e=pe(oe.id),t=parseFloat((0,c.gA)(F).times(e).toString())||0;z(t)}}),[oe,le,F,ge,pe,ne]);var Pe=(0,x.useCallback)((0,a.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le&&Ie in le&&Ce in le){e.next=2;break}return e.abrupt("return");case 2:if(t="getMethodDefaultGasLimit"in le?le.getMethodDefaultGasLimit("withdraw"):0,Q&&!be.lte(0)){e.next=5;break}return e.abrupt("return",t);case 5:return n={from:null===Q||void 0===Q?void 0:Q.address},a=le[Ce](be.toFixed()),r=le[Ie](a),e.next=10,(0,c.$K)(r,n);case 10:if(e.t0=e.sent,e.t0){e.next=13;break}e.t0=t;case 13:return s=e.t0,e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)}))),[Q,be,le,Ce,Ie]);(0,x.useEffect)((function(){K(null),ie===t&&(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Pe();case 3:t=e.sent,me(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),K(e.t0.message.toString().split("\n")[0]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}),[ie,t,Pe,me,K]),(0,x.useEffect)((function(){ie===t&&(ne({type:"SET_ASSET",payload:se}),ge&&le&&(ne({type:"SET_AMOUNT",payload:(0,c.gA)(F).toString()}),ne({type:"SET_DEFAULT_AMOUNT",payload:(0,c.gA)(F).toString()})))}),[le,se,F,ge,ie,t,ne,Ee]);var Ue=(0,x.useMemo)((function(){return Q?(0,I.jsx)(v.Translation,{component:j.zx,translation:q?"common.withdrawInterestBearing":"common.withdraw",disabled:Te,onClick:Ee,variant:"ctaFull",children:"started"===ve.status&&(0,I.jsx)(k.$,{size:"sm"})}):(0,I.jsx)(A.ConnectWalletButton,{variant:"ctaFull"})}),[Q,Te,ve,Ee,q]),De=(0,x.useMemo)((function(){return le&&"messages"in le?le.messages:void 0}),[le]),Le=(0,x.useMemo)((function(){return!Ze||be.lte(0)?null:(0,I.jsx)(l.Card.Dark,{px:2,py:3,border:0,children:(0,I.jsxs)(Z.gC,{spacing:2,width:"full",justifyContent:"center",children:[(0,I.jsx)(M.Ee,{src:"images/vaults/deprecated.png",width:6,height:6}),(0,I.jsx)(v.Translation,{textAlign:"center",textStyle:"captionSmaller",translation:"trade.actions.redeemInterestBearing.description"}),(0,I.jsx)(v.Translation,{component:C.XZ,size:"md",sx:{">span":{fontSize:"sm"}},translation:"trade.actions.redeemInterestBearing.label",isChecked:q,onChange:function(){return Ae()}})]})})}),[be,q,Ae,Ze]),_e=(0,x.useMemo)((function(){return null!==se&&void 0!==se&&se.interestBearingTokens&&null!==se&&void 0!==se&&se.vaultPosition&&le&&le instanceof u.H?(0,I.jsxs)(Z.gC,{spacing:2,width:"100%",alignItems:"flex-start",children:[(0,I.jsx)(v.Translation,{mb:1,component:Z.xv,translation:"dynamicActionFields.stkIDLE",suffix:":",textStyle:"titleSmall"}),Object.keys(null===se||void 0===se?void 0:se.interestBearingTokens).map((function(e){var t,n,i=ye(e)||le.tokenConfig.protocols.find((function(t){return t.address===e})),a=(0,c.d5)(null===se||void 0===se||null===(t=se.interestBearingTokens)||void 0===t?void 0:t[e]).times((0,c.d5)(null===se||void 0===se||null===(n=se.vaultPosition)||void 0===n?void 0:n.poolShare));return(0,I.jsxs)(Z.Ug,{pb:2,px:4,width:"100%",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"divider",justifyContent:"space-between",children:[(0,I.jsx)(Z.xv,{textStyle:"captionSmall",children:null===i||void 0===i?void 0:i.token}),(0,I.jsx)(o.Amount,{value:a,textStyle:"titleSmall",color:"primary"})]},"assetField_".concat(e))}))]}):null}),[se,le,ye]);return(0,I.jsx)(b.AssetProvider,{flex:1,width:"100%",assetId:null===se||void 0===se?void 0:se.id,children:(0,I.jsxs)(Z.gC,{pt:8,flex:1,spacing:6,width:"100%",height:"100%",id:"withdraw-container",alignItems:"space-between",justifyContent:"flex-start",children:[(0,I.jsxs)(Z.gC,{flex:1,spacing:6,width:"100%",alignItems:"flex-start",children:[(0,I.jsxs)(Z.Ug,{width:"100%",spacing:[3,4],alignItems:"flex-start",children:[(0,I.jsx)(Z.xu,{pt:8,children:(0,I.jsx)(m.AssetLabel,{assetId:null===se||void 0===se?void 0:se.id})}),(0,I.jsxs)(Z.gC,{spacing:1,width:"100%",alignItems:"flex-start",children:[(0,I.jsx)(l.Card,{px:4,py:2,layerStyle:"cardLight",children:(0,I.jsxs)(Z.gC,{spacing:2,alignItems:"flex-start",children:[(0,I.jsx)(f.InputAmount,{amount:F,amountUsd:G,setAmount:T,isDisabled:O}),(0,I.jsxs)(Z.Ug,{width:"100%",justifyContent:"space-between",children:[(0,I.jsxs)(Z.Ug,{spacing:1,children:[(0,I.jsx)(v.Translation,{component:Z.xv,translation:"common.balance",textStyle:"captionSmaller"}),(0,I.jsx)(b.AssetProvider.VaultBalance,{abbreviate:!0,decimals:4,textStyle:"captionSmaller",color:"primary"})]}),(0,I.jsx)(j.zx,{variant:"selector",onClick:Fe,children:"MAX"})]})]})}),U&&(0,I.jsx)(Z.xv,{textStyle:"captionSmaller",color:"orange",children:U})]})]}),$?(0,I.jsx)(l.Card.Dark,{p:2,border:0,children:(0,I.jsx)(v.Translation,{textStyle:"captionSmaller",translation:"trade.actions.withdraw.messages.gasEstimateError",params:{supportLink:'<a href="https://discord.com/channels/606071749657755668/606073687799627776">Discord channel</a>',error:$},isHtml:!0,textAlign:"center"})}):Be.gt(0)&&null!==De&&void 0!==De&&De.withdraw?(0,I.jsx)(l.Card.Dark,{p:2,border:0,children:(0,I.jsx)(v.Translation,{textStyle:"captionSmaller",translation:De.withdraw,isHtml:!0,textAlign:"center"})}):(0,c.gA)(null===ke||void 0===ke?void 0:ke.balance).gt(0)&&(0,I.jsx)(l.Card.Dark,{py:2,pl:3,pr:2,border:0,children:(0,I.jsxs)(Z.Ug,{spacing:3,width:"full",children:[(0,I.jsx)(v.Translation,{textStyle:"captionSmaller",translation:"trade.actions.withdraw.messages.unstakeFromGauge",textAlign:"left"}),(0,I.jsx)(v.Translation,{component:j.zx,translation:"common.unstake",fontSize:"xs",height:"auto",width:"auto",py:3,px:7,onClick:function(){return Se("?tab=gauge")}})]})}),Ze&&q?_e:(0,I.jsx)(S.DynamicActionFields,{assetId:null===se||void 0===se?void 0:se.id,action:"withdraw",amount:F,amountUsd:G})]}),(0,I.jsxs)(Z.gC,{spacing:4,id:"footer",alignItems:"flex-start",children:[Le,(0,I.jsx)(w.EstimatedGasFees,{}),Ue]})]})})}}}]);